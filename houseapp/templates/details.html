{% extends "base.html" %}

{% block content %}

<head>    
  <meta charset="utf-8">    
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">  
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <style>
    body {
      margin: 0;
      font: 13px/1.5 "Microsoft YaHei", "Helvetica Neue", "Sans-Serif";
      min-height: 960px;
      min-width: 600px;
    }

    .my-map {
      margin: 0 auto;
      width: 800px;
      height: 640px;
    }

    .my-map .icon {
      background: url(//a.amap.com/lbs-dev-yuntu/static/web/image/tools/creater/marker.png) no-repeat;
    }

    .my-map .icon-cir {
      height: 31px;
      width: 28px;
    }

    .my-map .icon-cir-red {
      background-position: -11px -5px;
    }

    .amap-container {
      height: 100%;
    }

    .myinfowindow {
      width: 240px;
      min-height: 50px;
    }

    .myinfowindow h5 {
      height: 20px;
      line-height: 20px;
      overflow: hidden;
      font-size: 14px;
      font-weight: bold;
      width: 220px;
      text-overflow: ellipsis;
      word-break: break-all;
      white-space: nowrap;
    }

    .myinfowindow div {
      margin-top: 10px;
      min-height: 40px;
      line-height: 20px;
      font-size: 13px;
      color: #6f6f6f;
    }
  </style>
</head>

<body>
  <table class="table table-condensed" style="margin-top: 70px; margin-left: 50px;margin-right: 100px; width: 92%;">
    <tr>
      <td rowspan="7" width="50%">
        <div id="myCarousel" class="carousel slide">
          {% if stored_images %}
          <ol class="carousel-indicators">
            {% for l in range(stored_images|length) %}
            {% if l == 0 %}

            <li data-target="#myCarousel" data-slide-to="{{ l }}" class="active"></li>
            {% else %}
            <li data-target="#myCarousel" data-slide-to="{{ l }}"></li>
            {% endif %}
            {% endfor %}
          </ol>
          <div class="carousel-inner">
            {% for i in stored_images [:1]%}
            <div class="item active" style="width: 100%;height: 350px">
              <img src="{{ i.filepath }}" alt="{{ i.filepath }}" style="width: 100%;height: 350px;" class="img-rounded">
            </div>
            {% endfor %}
            {% for i in stored_images [1:]%}
            <div class="item" style="width: 100%;height: 50%;height: 350px;">
              <img src="{{ i.filepath }}" alt="{{ i.filepath }}" style="width: 100%;height: 350px;" class="img-rounded">
            </div>
            {% endfor %}
            {% else %}
            <ol class="carousel-indicators">
              <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
            </ol>
            <div class="carousel-inner">
              <div class="item active" style="width: 100%;height: 350px">
                <img src="{{ url_for('static', filename='img/house4.jpg') }}" alt="house1"
                  style="width: 100%;height: 350px" class="img-rounded">s
              </div>
            </div>
            {% endif %}
            {% if stored_images|length > 1 %}
            <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
            {% endif %}
          </div>
        </div>
      </td>
      <td style="vertical-align: top; padding-left: 20px; height: 30%;">
        {% if house.total_price %}
        {% if house.status == 1 %}
        {% if house.user_id == user.id %}
        <span>
          <h2 style="color: red;"><strong>¥ {{ '%.2f' %(house.total_price) }}</strong></h2>
        </span>
        {% endif %}
        {% else %}
        <h2 style="color: red;"><strong>¥ {{ '%.2f' %(house.total_price) }}</strong></h2>
        {% endif %}
        {% else %}
        <h2 style="color: red;"><strong>Pending</strong></h2>
        {% endif %}
        {% if house.total_price %}
        <p style="color: darkgray; font-size: 15px;">¥ {{ '%.2f' %(house.total_price / house.square) }}</p>
        {% else %}
        <p style="color: darkgray; font-size: 15px;">Pending</p>
        {% endif %}
      </td>
      {% if house.total_price %}
      {% if house.status == 1 %}
      {% if house.user_id == user.id %}
      <td style="vertical-align: middle;" align="right">
        <a href="{{ url_for('edit_house',house_id=house.id) }}"><button class="btn btn-defult" type="button"
            name="button" style="margin-right: 10px;"><span class="glyphicon glyphicon-edit"
              style="padding-top: 3px;"></span>&nbsp;Edit</button></a>
        {% if stored_images %}
        <a><button class="btn btn-defult" type="button" name="button" data-toggle="modal" data-target="#upload"><span
              class="glyphicon glyphicon-cloud-upload" style="padding-top: 3px;"></span>&nbsp;Upload</button></a>
        {% else %}
        <a><button class="btn btn-defult" type="button" name="button" data-toggle="modal"
            data-target="#need_picture"><span class="glyphicon glyphicon-cloud-upload"
              style="padding-top: 3px;"></span>&nbsp;Upload</button></a>
        {% endif %}

      </td>
      <div class="modal fade" id="upload" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                &times;
              </button>
              <h4 class="modal-title" id="myModalLabel">
                Are you sure to upload?
              </h4>
            </div>
            <div class="modal-body">
              You will upload the house with id:&nbsp;<b>{{ house.id }}</b>.
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal">No
              </button>
              <a href="{{ url_for('upload_house',house_id1=house.id) }}"><button type="button"
                  class="btn btn-success btn-sm">Yes
                </button></a>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="need_picture" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                &times;
              </button>
              <h4 class="modal-title" id="myModalLabel">
                Go to upload your picture!
              </h4>
            </div>
            <div class="modal-body">
              You should upload at least one picture of the house.
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal">Cancel
              </button>
              <a href="{{ url_for('edit_house',house_id=house.id) }}"><button type="button"
                  class="btn btn-success btn-sm">Go To Edit
                </button></a>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
      {% elif house.status == 2 %}
      {% if house.user_id == user.id %}
      <td style="vertical-align: middle;" align="right">
        <a href="{{ url_for('edit_house',house_id=house.id) }}"><button class="btn btn-defult" type="button"
            name="button"><span class="glyphicon glyphicon-edit"
              style="padding-top: 3px;"></span>&nbsp;Edit</button></a>
      </td>
      {% endif %}
      {% endif %}
      {% if not house.user_id == user.id %}
      {% if favorite %}
      <td style="vertical-align: top;" align="right">
        <a href="{{ url_for('remove_favorite',house_id2=house.id, user_id2=user.id) }}"><button
            class="btn btn-danger btn-xs" type="button" name="button"><span class="glyphicon glyphicon-star"
              style="padding-top: 3px;"></span>&nbsp;Remove from Favorite </button></a>
      </td>
      {% else %}
      <td style="vertical-align: top;" align="right">
        <a href="{{ url_for('add_to_favorite',house_id2=house.id, user_id2=user.id) }}"><button
            class="btn btn-warning btn-xs" type="button" name="button"><span class="glyphicon glyphicon-star-empty"
              style="padding-top: 3px;"></span>&nbsp;Add to Favorite </button></a>
      </td>
      {% endif %}
      {% endif %}
      {% endif %}
    </tr>

    <tr>
      <td style="padding-left: 20px;vertical-align: middle;">Building Type:</td>
      {% if house.building_type == 1 %}
      <td width="20%" style="vertical-align: middle;"><b>Tower</b></td>
      {% elif house.building_type == 2 %}
      <td width="20%" style="vertical-align: middle;"><b>Bungalow</b></td>
      {% elif house.building_type == 3 %}
      <td width="20%" style="vertical-align: middle;"><b>Plate & Tower</b></td>
      {% elif house.building_type == 4 %}
      <td width="20%" style="vertical-align: middle;"><b>Plate</b></td>
      {% endif %}
    </tr>

    <tr class="active">
      <td style="padding-left: 20px;vertical-align: middle;">Square:</td>
      <td width="20%" style="vertical-align: middle;"><b>{{ house.square }} sq metres</b></td>
    </tr>
    <tr>
      <td style="padding-left: 20px;vertical-align: middle;">Floor:</td>
      <td width="20%" style="vertical-align: middle;"><b>{{ house.floor }}</b></td>
    </tr>

    <tr class="active">
      <td style="padding-left: 20px;vertical-align: middle;">Renovation Type:</td>
      {% if house.renovation_con == 1 %}
      <td width="20%" style="vertical-align: middle;"><b>Other</b></td>
      {% elif house.renovation_con == 2 %}
      <td width="20%" style="vertical-align: middle;"><b>Rough</b></td>
      {% elif house.renovation_con == 3 %}
      <td width="20%" style="vertical-align: middle;"><b>Simplicity</b></td>
      {% elif house.renovation_con == 4 %}
      <td width="20%" style="vertical-align: middle;"><b>Hardcover</b></td>
      {% endif %}
    </tr>

    <tr>
      <td style="padding-left: 20px;vertical-align: middle;">District:</td>
      {% if house.district == 1 %}
      <td width="20%" style="vertical-align: middle;"><b>DongCheng</b></td>
      {% elif house.district == 2 %}
      <td width="20%" style="vertical-align: middle;"><b>FengTai</b></td>
      {% elif house.district == 3 %}
      <td width="20%" style="vertical-align: middle;"><b>TongZhou</b></td>
      {% elif house.district == 4 %}
      <td width="20%" style="vertical-align: middle;"><b>DaXing</b></td>
      {% elif house.district == 5 %}
      <td width="20%" style="vertical-align: middle;"><b>FangShan</b></td>
      {% elif house.district == 6 %}
      <td width="20%" style="vertical-align: middle;"><b>ChangPing</b></td>
      {% elif house.district == 7 %}
      <td width="20%" style="vertical-align: middle;"><b>ChaoYang</b></td>
      {% elif house.district == 8 %}
      <td width="20%" style="vertical-align: middle;"><b>HaiDian</b></td>
      {% elif house.district == 9 %}
      <td width="20%" style="vertical-align: middle;"><b>XiCheng</b></td>
      {% elif house.district == 10 %}
      <td width="20%" style="vertical-align: middle;"><b>ShiJingShan</b></td>
      {% elif house.district == 11 %}
      <td width="20%" style="vertical-align: middle;"><b>PingGu</b></td>
      {% elif house.district == 12 %}
      <td width="20%" style="vertical-align: middle;"><b>MenTouGou</b></td>
      {% elif house.district == 13 %}
      <td width="20%" style="vertical-align: middle;"><b>ShunYi</b></td>
      {% endif %}
    </tr>

  </table>
  <div style="margin: 30px 50px 30px 50px;">
    <div class="panel-group" id="accordion">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#details">
              <b style="font-size:3rem;">Details</b>
            </a>
          </h4>
        </div>
        <div id="details" class="panel-collapse collapse in">
          <div class="panel-body">
            <table class="table">
              <tr>
                <td style="padding-left: 20px;vertical-align: middle;">Total Price:</td>
                {% if house.total_price %}
                <td width="20%" style="vertical-align: middle;"><b>¥ {{ house.total_price }}</b></td>
                {% else %}
                <td width="20%" style="vertical-align: middle;"><b>Pending</b></td>
                {% endif %}
                <td rowspan="12" width="50%" align="center" style="border: 0rem;vertical-align: middle;"><img
                    src="{{ url_for('static', filename='img/house_inside.png') }}" alt="house_inside" width="80%"></td>
              </tr>
              <tr class="active">
                <td style="padding-left: 20px;vertical-align: middle;">Price:</td>
                {% if house.total_price %}
                <td width="20%" style="vertical-align: middle;"><b>¥ {{ '%.2f' %(house.total_price / house.square)
                    }}</b></td>
                {% else %}
                <td width="20%" style="vertical-align: middle;"><b>Pending</b></td>
                {% endif %}
              </tr>
              <tr>
                <td style="padding-left: 20px;vertical-align: middle;">Square:</td>
                <td width="20%" style="vertical-align: middle;"><b>{{ house.square }}</b></td>
              </tr>
              <tr class="active">
                <td style="padding-left: 20px;vertical-align: middle;">Livingroom:</td>
                <td width="20%" style="vertical-align: middle;"><b>{{ house.living_room }}</b></td>
              </tr>
              <tr>
                <td style="padding-left: 20px;vertical-align: middle;">Drawingroom:</td>
                <td width="20%" style="vertical-align: middle;"><b>{{ house.drawing_room }}</b></td>
              </tr>
              <tr class="active">
                <td style="padding-left: 20px;vertical-align: middle;">Kitchen:</td>
                <td width="20%" style="vertical-align: middle;"><b>{{ house.kitchen }}</b></td>
              </tr>
              <tr>
                <td style="padding-left: 20px;vertical-align: middle;">Bathroom:</td>
                <td width="20%" style="vertical-align: middle;"><b>{{ house.bathroom }}</b></td>
              </tr>
              <tr class="active">
                <td style="padding-left: 20px;vertical-align: middle;">Floor:</td>
                <td width="20%" style="vertical-align: middle;"><b>{{ house.floor }}</b></td>
              </tr>
              <tr>
                <td style="padding-left: 20px;vertical-align: middle;">Elevator: </td>
                {% if house.elevator == 1 %}
                <td width="20%" style="vertical-align: middle;"><b>Available</b></td>
                {% elif house.elevator == 0 %}
                <td width="20%" style="vertical-align: middle;"><b>Not Available</b></td>
                {% endif %}
              </tr>
              <tr class="active">
                <td style="padding-left: 20px;vertical-align: middle;">Subway: </td>
                {% if house.subway == 1 %}
                <td width="20%" style="vertical-align: middle;"><b>Available</b></td>
                {% elif house.subway == 0 %}
                <td width="20%" style="vertical-align: middle;"><b>Not Available</b></td>
                {% endif %}
              </tr>

              <tr>
                <td style="padding-left: 20px;vertical-align: middle;">Building Type:</td>
                {% if house.building_type == 1 %}
                <td width="20%" style="vertical-align: middle;"><b>Tower</b></td>
                {% elif house.building_type == 2 %}
                <td width="20%" style="vertical-align: middle;"><b>Bungalow</b></td>
                {% elif house.building_type == 3 %}
                <td width="20%" style="vertical-align: middle;"><b>Plate & Tower</b></td>
                {% elif house.building_type == 4 %}
                <td width="20%" style="vertical-align: middle;"><b>Plate</b></td>
                {% endif %}
              </tr>

              <tr class="active">
                <td style="padding-left: 20px;vertical-align: middle;">Renovation Type:</td>
                {% if house.renovation_con == 1 %}
                <td width="20%" style="vertical-align: middle;"><b>Other</b></td>
                {% elif house.renovation_con == 2 %}
                <td width="20%" style="vertical-align: middle;"><b>Rough</b></td>
                {% elif house.renovation_con == 3 %}
                <td width="20%" style="vertical-align: middle;"><b>Simplicity</b></td>
                {% elif house.renovation_con == 4 %}
                <td width="20%" style="vertical-align: middle;"><b>Hardcover</b></td>
                {% endif %}
              </tr>

            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="panel-group" id="accordion">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#recommendation">
              <b style="font-size:3rem;">Recommendation</b>
            </a>
          </h4>
        </div>
        <div id="recommendation" class="panel-collapse collapse in">
          {% if stored_recomm %}
          <div class="panel-body">

            <p style="margin-left: 15px;">{{ stored_recomm.reason }}</p>

          </div>
          {% else %}
          <div class="panel-body">
            <p style="margin: 10px 0 0 15px;color: gray;">The seller hasn't released any recommendation yet.</p>
          </div>
          {% endif %}
          <div id="contact" style="margin-left: 30px;margin-right: 30px;margin-top: 10px;">
            <p style="font-size: large;"><b>Contact Agent</b></p>
            <hr>
            <table width="60%" style="margin-bottom: 30px;">
              <tr>
                <td width="20%" style="color:steelblue;"><span class="glyphicon glyphicon-user"></span><b><a
                      href="{{ url_for('visitothers', user_id=owner.id) }}">&nbsp;&nbsp;&nbsp;{{ owner.username
                      }}</b></a></td>
                <td style="color:steelblue"><span class="glyphicon glyphicon-envelope"></span><b>&nbsp;&nbsp;&nbsp;{{
                    owner.email }}</b></td>
              </tr>
            </table>
          </div>

        </div>
      </div>
    </div>
    <div class="panel-group" id="accordion">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#location">
              <b style="font-size:3rem;">Location</b>
            </a>
          </h4>
        </div>
        <div id="location" class="panel-collapse collapse in">
          <div id="wrap" class="my-map" style="margin: 35px 20px 0px 20px;">
            <!-- <h3>Lng: {{ house.lng }}; Lat: {{ house.lat }}</h3> -->
            <div id="mapContainer" style="width:140%;height:600px"></div>
          </div>
        </div>
      </div>
    </div>
    {% if house.status == 2 %}
    <div class="panel-group" id="accordion">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#loan">
              <b style="font-size:3rem;">Loan Calculation</b>
            </a>
          </h4>
        </div>
        <div id="loan" class="panel-collapse collapse in">
          <form action="" method="post" novalidate style="margin-left: 10px; margin-right: 10px;margin-bottom: 20px;">
            {{ form4.hidden_tag() }}
            <table style="width:100%;">
              <tr>
                <td style="width: 45%;">
                  <div class="input-group" style="margin-top: 20px;padding-left: 10px;padding-right: 10px;">
                    <span class="input-group-addon">Loan Type</span>
                    {{ form4.money_type(class="form-control") }}
                  </div>
                </td>
                 <td style="width: 45%;">
                  <div class="input-group" style="margin-top: 20px;padding-left: 10px;padding-right: 10px;">
                    <span class="input-group-addon">Number of House</span>
                    {{ form4.house_number(class="form-control") }}
                  </div>
                </td>
                <td rowspan="2" style="width:10%">{{ form4.calculate(class="button", style="height:85px;margin-top:20px;") }}</td>

              </tr>
              <tr>
                <td>
                  <div class="input-group" style="margin-top: 20px;padding-left: 10px;padding-right: 10px;">
                    <span class="input-group-addon">Price Percentage</span>
                    {{ form4.price(class="form-control") }}
                  </div>
                </td>
                 <td>
                  <div class="input-group" style="margin-top: 20px;padding-left: 10px;padding-right: 10px;">
                    <span class="input-group-addon">Loan Months</span>
                    {{ form4.month(class="form-control") }}
                  </div>
                </td>
              </tr>
              <tr>
                <td><div id="container" style="min-width:400px;height:400px;margin-top: 10px;"></div></td>

                <td colspan="2" >
                  <table class="table table-hover" style="margin:0 10px 0 10px;width: 95%;">
                    <tr>
                      <td><b>Loan Type</b></td>
                      {% if money.money_type == 1 %}
                      <td>Commercial Loan</td>
                      {% elif money.money_type == 2 %}
                      <td>Housing Provident Fund Loans</td>
                      {% endif %}
                    </tr>
                    <tr>
                      <td><b>Number of House</b></td>
                      {% if money.house_number == 1 %}
                      <td>First House Loan</td>
                      {% elif money.house_number == 2 %}
                      <td>Second House Loan</td>
                      {% endif %}
                    </tr>
                    <tr>
                      <td><b>Price Percentage</b></td>
                      <td>{{ money.price_percentage }}0%</td>
                    </tr>
                    <tr>
                      <td><b>Loan Months</b></td>
                      <td>{{ money.month*12 }} months</td>
                    </tr>
                    <tr>
                      <td><b>Down Payment</b></td>
                      <td>¥ {{ '%.2f' %(money_calculate[0]) }}</td>
                    </tr>
                    <tr>
                      <td><b>Monthly Repayment</b></td>
                      <td>¥ {{ '%.2f' %(money_calculate[1]) }}</td>
                    </tr>
                    <tr>
                      <td><b>Total Interest</b></td>
                      <td>¥ {{ '%.2f' %(money_calculate[2]) }}</td>
                    </tr>
                    <tr>
                      <td><b>Total Repayment</b></td>
                      <td>¥ {{ '%.2f' %(money_calculate[4]) }}</td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </form>
        </div>
      </div>
    </div>

    <div class="panel-group" id="accordion" style="margin-top: 20px;margin-bottom: 50px;">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#comments">
              <b style="font-size:3rem;">Comments</b>
            </a>
          </h4>
        </div>
        <div id="comments" class="panel-collapse collapse in">
          <div class="panel-body">
            <table style="margin-left: 20px; margin-right: 20px;width: 100%;">
              {% if comments %}
              {% for c in comments %}
              <tr>
                {% if c.user_id == owner.id %}
                <td width="9%" style="vertical-align: top;padding-top: 13px;"><span
                    class="glyphicon glyphicon-user"></span><a
                    href="{{ url_for('visitothers', user_id=c.user_id) }}"><b>&nbsp;&nbsp;{{ c.user_id }}</b><span
                      class="label label-warning" style="margin-left: 7px;vertical-align: middle;">owner</span></a></td>
                {% else %}
                <td width="9%" style="vertical-align: top;padding-top: 13px;"><span
                    class="glyphicon glyphicon-user"></span><a href="{{ url_for('visitothers', user_id=c.user_id) }}"
                    <b>&nbsp;&nbsp;{{ c.user_id }}</b><span class="label label-info"
                      style="margin-left: 7px;vertical-align: middle;">user</a></span>
                </td>
                {% endif %}
                <td class="comment">{{ c.body }}
                  <a href="{{ url_for('details', house_id=house.id, comment_id=c.id, reply=True)}}">
                    <button type="button" name="button" id="reply_btn" class="btn btn-default btn-xs">Reply</button>
                  </a>
                  {% if answers[c.id] %}
                  <ul>
                    {% for a in answers[c.id] %}
                    <li>User <a href="{{ url_for('visitothers', user_id=a.user_id) }}">{{ a.user_id }}</a> said: {{
                      a.body }}</li>
                    {% endfor %}
                  </ul>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
              {% else %}
              <div class="panel-body">
                <p style="margin: 10px 0 0 10px;color: gray;">No comment yet.</p>
              </div>
              {% endif %}
            </table>
            <hr style="margin-right: 20px;margin-left: 20px;">
            <div class="panel-body">
              {% if user %}
              {% if reply %}
              <!-- reply function -->
              <!-- <div id="reply_form" style="display:none"> -->
              <div>
                <form action="" method="post" novalidate style="margin-right: 30px;">
                  {{ form3.hidden_tag() }}
                  <p>
                    {{ form3.comment.label }}<br>
                    {{ form3.comment(rows=8, cols=80, class="form-control",placeholder="Replying") }}

                    {% for error in form3.comment.errors %}
                    <span style="color: red;">[{{ error }}]</span>
                    {% endfor %}
                  </p>
                  <p align="right">{{ form3.submit(class="btn btn-defult") }}</p>
              </div>

              {% else %}
              <!-- comment function  -->
              <div id="comment_form">
                <form action="" method="post" novalidate>
                  {{ form.hidden_tag() }}
                  <p>
                    {{ form.comment.label }}<br>
                    {{ form.comment(rows=8, cols=80, class="form-control") }}

                    {% for error in form.comment.errors %}
                    <span style="color: red;">[{{ error }}]</span>
                    {% endfor %}
                  </p>
                  <p align="right">{{ form.submit(class="btn btn-defult") }}</p>
              </div>
              {% endif %}
              {% else %}
              <p style="color: red; "><b>You have to log in to comment</b></p><br>
              <p><span>Already have an account?</span>
                <a href="{{ url_for('login') }}"><span class="glyphicon glyphicon-user"></span> Log in</a>
              </p><br>
              <p><span>Create an account? </span>
                <a href="{{ url_for('signup') }}"><span class="glyphicon glyphicon-user"></span> Register</a>
              </p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>

  {% if house.status == 2 %}
  <div>
    <h1> Users who like this house also like...</h1>
    <hr>
    <div class="lb_gl">
      <div class="container">
        <div class="pictureSlider poster-main">
          <div class="poster-btn poster-prev-btn"></div>
          <div id="zturn" class="poster-list">
            {% for h in re_houses %}
            <div class="poster-item  zturn-item">
              <p class="houseid">House ID: {{ h.id }}</p>
              <div class="for_btn">
                <a href="{{ url_for('details', house_id=h.id )}}" id="image"><img
                    src="{{ url_for('static', filename='img/house4.jpg') }}" width="100%"></a>
              </div>

              <div class="property">
                <p class="pro">Total Price：<span class="per">¥ {{ '%.2f' %(h.total_price) }}</span>
                </p>
                <p class="pro"><span>Square：<span class="per">{{ h.square }} m<sup>2</sup></span></span>
                </p>
                <div class="recommendation">

                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div>
      <h1> Popular Houses</h1>
      <hr>
      <div class="lb_gl">
        <div class="container">
          <div class="pictureSlider poster-main">
            <div class="poster-btn poster-prev-btn"></div>
            <div id="zturn" class="poster-list">
              {% for h in pop_houses %}
              <div class="poster-item  zturn-item">
                <p class="houseid">House ID: {{ h.id }}</p>
                <div class="for_btn">
                  <a href="{{ url_for('details', house_id=h.id )}}" id="image"><img
                      src="{{ url_for('static', filename='img/house4.jpg') }}" width="100%"></a>
                </div>

                <div class="property">
                  <p class="pro">Total Price：<span class="per">¥ {{ '%.2f' %(h.total_price) }}</span>
                  </p>
                  <p class="pro"><span>Square：<span class="per">{{ h.square }} m<sup>2</sup></span></span>
                  </p>
                  <div class="recommendation">

                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endif %}
</body>
<style>
  .comment {
    background-color: rgb(235, 235, 235);
    padding: 5px 8px;
    display: inline-block;
    border-radius: 4px;
    margin: 10px 0 10px 10px;
    position: relative;

  }

  .comment::after {
    content: '';
    border: 8px solid #ffffff00;
    border-right: 8px solid rgb(235, 235, 235);
    position: absolute;
    top: 6px;
    left: -16px;
  }
  .button {
        border: none;
        color: white;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 18px;
        -webkit-transition-duration: 0.4s;
        /* Safari */
        transition-duration: 0.4s;
        cursor: pointer;
        background-color: #434348;
        color: #ffffff;
        border: 2px solid #434348;
    }

    .button:hover {
        background-color: #ffffff;
        color: #434348;
    }
</style>
<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=您申请的key值&plugin=AMap.Geocoder"></script>
<script src="https://code.highcharts.com.cn/highcharts/highcharts.js"></script>
<script src="https://code.highcharts.com.cn/highcharts/modules/exporting.js"></script>
<script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
<script>
  Highcharts.chart('container', {
		chart: {
				plotBackgroundColor: null,
				plotBorderWidth: null,
				plotShadow: false,
				type: 'pie'
		},
		title: {
				text: 'Down payment, Principal, Interest'
		},
		tooltip: {
				pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
		},
    credits: {
                enabled:false
            },

    exporting: {
                enabled:false
            },
		plotOptions: {
				pie: {
						allowPointSelect: true,
						cursor: 'pointer',
						dataLabels: {
								enabled: false
						},
						showInLegend: true
				}
		},
		series: [{
				name: 'Percentage',
				colorByPoint: true,
				data: [{
						name: 'Down payment',
						y: parseFloat("{{ money_calculate[0]/(money_calculate[0]+money_calculate[4]) }}")
				}, {
						name: 'Principal',
						y: parseFloat("{{ money_calculate[2]/(money_calculate[0]+money_calculate[4]) }}")
				}, {
						name: 'Interest',
						y: parseFloat("{{ (money_calculate[4]-money_calculate[2])/(money_calculate[0]+money_calculate[4]) }}")
				}]
		}]
});
  !function () {
    var infoWindow, map, level = 11,
      center = {lng:{{house.lng}},lat: {{ house.lat }}},
  features = [{ "icon": "cir", "color": "red", "name": "未命名标注", "desc": "未命名标注描述", "lnglat": { "Q": {{ house.lat }}, "R": {{ house.lng }}, "lng": {{ house.lng }}, "lat": {{ house.lat }}}, "offset": { "x": -9, "y": -31 }, "type": "Marker"}];

  function loadFeatures() {
    for (var feature, data, i = 0, len = features.length, j, jl, path; i < len; i++) {
      data = features[i];
      switch (data.type) {
        case "Marker":
          feature = new AMap.Marker({
            map: map, position: new AMap.LngLat(data.lnglat.lng, data.lnglat.lat),
            zIndex: 3, extData: data, offset: new AMap.Pixel(data.offset.x, data.offset.y), title: data.name,
            content: '<div class="icon icon-' + data.icon + ' icon-' + data.icon + '-' + data.color + '"></div>'
          });
          break;
        case "Polyline":
          for (j = 0, jl = data.path.length, path = []; j < jl; j++) {
            path.push(new AMap.LngLat(data.path[j].lng, data.path[j].lat));
          }
          feature = new AMap.Polyline({
            map: map, path: path, extData: data, zIndex: 2,
            strokeWeight: data.strokeWeight, strokeColor: data.strokeColor, strokeOpacity: data.strokeOpacity
          });
          break;
        case "Polygon":
          for (j = 0, jl = data.path.length, path = []; j < jl; j++) {
            path.push(new AMap.LngLat(data.path[j].lng, data.path[j].lat));
          }
          feature = new AMap.Polygon({
            map: map, path: path, extData: data, zIndex: 1,
            strokeWeight: data.strokeWeight, strokeColor: data.strokeColor, strokeOpacity: data.strokeOpacity,
            fillColor: data.fillColor, fillOpacity: data.fillOpacity
          });
          break;
        default: feature = null;
      }
      if (feature) { AMap.event.addListener(feature, "click", mapFeatureClick); }
    }
  }

  function mapFeatureClick(e) {
    if (!infoWindow) { infoWindow = new AMap.InfoWindow({ autoMove: true, isCustom: false }); }
    var extData = e.target.getExtData();
    infoWindow.setContent("<div class='myinfowindow'><h5>" + extData.name + "</h5><div>" + extData.desc + "</div></div>");
    infoWindow.open(map, e.lnglat);
  }

  map = new AMap.Map("mapContainer", { center: new AMap.LngLat(center.lng, center.lat), lang: "en", level: level, zoom: 15, scrollWheel: false });
  new AMap.TileLayer.RoadNet({ map: map, zIndex: 2 }); new AMap.TileLayer.Traffic({ map: map, zIndex: 3 });
  loadFeatures();

  map.on('complete', function () {
    map.plugin(["AMap.ToolBar", "AMap.OverView", "AMap.Scale"], function () {
      map.addControl(new AMap.ToolBar({ ruler: true, direction: true, locate: false })); map.addControl(new AMap.OverView({ isOpen: true })); map.addControl(new AMap.Scale);
    });
  })

}();
</script>


{% include 'footer.html' %}
{% endblock %}